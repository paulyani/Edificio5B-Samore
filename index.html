<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Contacto Edificio por WhatsApp</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #d4f1f4, #0d324d);
    color: #0d324d;
    min-height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }

  main {
    background: #ffffffdd;
    max-width: 420px;
    width: 100%;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgb(13 50 77 / 0.3);
    padding: 30px 30px 40px;
    text-align: center;
  }

  h1 {
    margin-bottom: 18px;
    font-weight: 700;
    font-size: 1.8rem;
    letter-spacing: 1.3px;
    color: #065a82;
  }

  label {
    display: block;
    text-align: left;
    font-weight: 600;
    margin-top: 20px;
    margin-bottom: 6px;
    color: #09527a;
    user-select: none;
  }

  select, input[type="text"] {
    width: 100%;
    padding: 12px 15px;
    border-radius: 12px;
    border: 2px solid #a6c8d9;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  select:hover, input[type="text"]:hover {
    border-color: #488fc2;
  }
  select:focus, input[type="text"]:focus {
    border-color: #09527a;
    outline: none;
    box-shadow: 0 0 6px #2b6ca3aa;
  }

  #personaContainer {
    margin-top: 10px;
  }

  button {
    margin-top: 26px;
    width: 100%;
    background: #09527a;
    color: white;
    font-weight: 700;
    font-size: 1.15rem;
    padding: 14px 0;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgb(9 82 122 / 0.4);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
  }
  button:hover {
    background-color: #0c75c0;
    box-shadow: 0 8px 20px rgb(12 117 192 / 0.6);
  }

  #btnPorteria {
    margin-top: 12px;
    background: #28a745;
    box-shadow: 0 5px 15px rgb(40 167 69 / 0.4);
  }
  #btnPorteria:hover {
    background-color: #3ec16f;
    box-shadow: 0 8px 20px rgb(62 193 111 / 0.7);
  }

  #mensaje {
    margin-top: 25px;
    font-weight: 600;
    min-height: 26px;
    font-size: 1rem;
    user-select: none;
    color: #096c13;
    transition: color 0.3s ease;
  }

  #mensaje.error {
    color: #b92c2c;
  }

  /* Emoji pequeño al lado de mensaje */
  #mensaje::before {
    content: "";
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }
  #mensaje.success::before {
    content: "✅";
  }
  #mensaje.error::before {
    content: "❌";
  }
</style>
</head>
<body>

<main>
  <h1>Enviar mensaje a contacto</h1>

  <label for="deptoSelect">Departamento:</label>
  <select id="deptoSelect" aria-label="Seleccionar departamento">
    <option value="">-- Seleccioná un departamento --</option>
    <option value="PB-Porteria">PB - Portería</option>
    <option value="1F">1F</option>
    <option value="2F">2F</option>
    <option value="3F">3F</option>
    <option value="4F">4F</option>
    <option value="5F">5F</option>
    <option value="6F">6F</option>
    <option value="7F">7F</option>
    <option value="8F">8F</option>
    <option value="9F">9F</option>
  </select>

  <div id="personaContainer" style="display:none;">
    <label for="personaSelect">Persona:</label>
    <select id="personaSelect" aria-label="Seleccionar persona"></select>
  </div>

  <label for="tipo">Tipo (Ej: Repartidor, Visitante):</label>
  <input type="text" id="tipo" placeholder="Tu tipo aquí" aria-label="Tipo de persona" />

  <button onclick="enviarMensaje()">Enviar mensaje WhatsApp</button>
  <button id="btnPorteria" onclick="avisarPorteria()">Avisar a Portería</button>

  <div id="mensaje"></div>
</main>

<script>
  const contactos = {
    "PB-Porteria": [
      { nombre: "Portería General", numero: "541100000001" },
      { nombre: "Propietario PB 1", numero: "541100000002" },
      { nombre: "Propietario PB 2", numero: "541100000003" }
    ],
    "1F": [{ nombre: "Juan Pérez", numero: "541111111111" }],
    "2F": [{ nombre: "Ana Gómez", numero: "541122222222" }],
    "3F": [{ nombre: "Carlos López", numero: "541133333333" }],
    "4F": [{ nombre: "Lucía Martínez", numero: "541144444444" }],
    "5F": [{ nombre: "Pedro Sánchez", numero: "541155555555" }],
    "6F": [{ nombre: "Marta Díaz", numero: "541166666666" }],
    "7F": [{ nombre: "Diego Fernández", numero: "541177777777" }],
    "8F": [{ nombre: "Sofía Torres", numero: "541188888888" }],
    "9F": [{ nombre: "Luis Gómez", numero: "541199999999" }]
  };

  const deptoSelect = document.getElementById("deptoSelect");
  const personaSelect = document.getElementById("personaSelect");
  const personaContainer = document.getElementById("personaContainer");
  const mensajeDiv = document.getElementById("mensaje");

  window.onload = () => {
    const ultimoDepto = localStorage.getItem("ultimoDepto");
    if (ultimoDepto && contactos[ultimoDepto]) {
      deptoSelect.value = ultimoDepto;
      actualizarPersonas();
    }
  };

  deptoSelect.addEventListener("change", actualizarPersonas);

  function actualizarPersonas() {
    const depto = deptoSelect.value;
    localStorage.setItem("ultimoDepto", depto);
    const personas = contactos[depto] || [];
    personaSelect.innerHTML = "";
    if (personas.length > 1) {
      personaContainer.style.display = "block";
      personas.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.numero;
        opt.textContent = p.nombre;
        personaSelect.appendChild(opt);
      });
    } else {
      personaContainer.style.display = "none";
    }
  }

  function mostrarMensaje(msg, color = "green") {
    mensajeDiv.textContent = msg;
    if (color === "green") {
      mensajeDiv.classList.remove("error");
      mensajeDiv.classList.add("success");
    } else {
      mensajeDiv.classList.remove("success");
      mensajeDiv.classList.add("error");
    }
    setTimeout(() => {
      mensajeDiv.textContent = "";
      mensajeDiv.classList.remove("success", "error");
    }, 4000);
  }

  function enviarMensaje() {
    const depto = deptoSelect.value;
    const tipo = document.getElementById("tipo").value.trim();
    if (!depto || !contactos[depto]) {
      mostrarMensaje("Seleccioná un departamento válido", "red");
      return;
    }
    if (!tipo) {
      mostrarMensaje("Ingresá tu tipo (Ej: Repartidor)", "red");
      return;
    }
    const personas = contactos[depto];
    const contacto = personas.length > 1 ? personaSelect.value : personas[0].numero;
    const texto = `Hola, soy ${tipo}. Estoy en la entrada del edificio y quiero comunicarme con el Dpto ${depto}.`;
    const encodedMsg = encodeURIComponent(texto);
    const esMovil = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const baseUrl = esMovil ? "https://api.whatsapp.com/send" : "https://web.whatsapp.com/send";
    const url = `${baseUrl}?phone=${contacto}&text=${encodedMsg}`;
    window.open(url, "_blank");
    mostrarMensaje("Mensaje preparado para enviar.");
  }

  function avisarPorteria() {
    const persona = contactos["PB-Porteria"][0];
    const texto = "Hola, estoy en la entrada del edificio. Necesito comunicarme con la portería.";
    const encodedMsg = encodeURIComponent(texto);
    const esMovil = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const baseUrl = esMovil ? "https://api.whatsapp.com/send" : "https://web.whatsapp.com/send";
    const url = `${baseUrl}?phone=${persona.numero}&text=${encodedMsg}`;
    window.open(url, "_blank");
    mostrarMensaje("Aviso enviado a portería.");
  }
</script>

</body>
</html>
