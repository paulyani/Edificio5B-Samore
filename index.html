<!-- Ejemplo básico del HTML -->
<select id="depto" onchange="actualizarPersonas()">
  <option value="">Seleccioná un departamento</option>
  <option value="101">101</option>
  <option value="102">102</option>
  <option value="PB-Porteria">PB-Porteria</option>
  <!-- Agrega los departamentos que tengas -->
</select>

<div id="persona-container" style="display:none;">
  <select id="persona"></select>
</div>

<select id="tipo">
  <option value="Visitante">Visitante</option>
  <option value="Proveedor">Proveedor</option>
  <option value="Residente">Residente</option>
</select>

<button onclick="enviarMensaje()">Enviar Mensaje</button>
<button onclick="avisarPorteria()">Avisar Portería</button>

<div id="mensaje" style="margin-top:10px; font-weight:bold;"></div>

<script>
  // Ejemplo de contactos, adaptalo a tus datos reales
  const contactos = {
    "101": [
      { nombre: "Juan Pérez", numero: "5491123456789" }
    ],
    "102": [
      { nombre: "Ana Gómez", numero: "5491198765432" },
      { nombre: "Luis Martínez", numero: "5491165432109" }
    ],
    "PB-Porteria": [
      { nombre: "Portería", numero: "5491176543210" }
    ]
  };

  // Variables para elementos del DOM
  const deptoSelect = document.getElementById("depto");
  const personaSelect = document.getElementById("persona");
  const personaContainer = document.getElementById("persona-container");

  // Funciones
  function actualizarPersonas() {
    const depto = deptoSelect.value;
    localStorage.setItem("ultimoDepto", depto);
    const personas = contactos[depto] || [];
    personaSelect.innerHTML = "";
    if (personas.length > 1) {
      personaContainer.style.display = "block";
      personas.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.numero;
        opt.textContent = p.nombre;
        personaSelect.appendChild(opt);
      });
    } else {
      personaContainer.style.display = "none";
    }
  }

  function mostrarMensaje(msg, color = "green") {
    const mensajeDiv = document.getElementById("mensaje");
    mensajeDiv.textContent = msg;
    mensajeDiv.style.color = color;
    setTimeout(() => (mensajeDiv.textContent = ""), 4000);
  }

  function enviarMensaje() {
    const depto = deptoSelect.value;
    const tipo = document.getElementById("tipo").value;
    if (!depto || !contactos[depto]) {
      mostrarMensaje("Seleccioná un departamento válido", "red");
      return;
    }
    const personas = contactos[depto];
    const contacto = personas.length > 1 ? personaSelect.value : personas[0].numero;
    const texto = `Hola, soy ${tipo}. Estoy en la entrada del edificio y quiero comunicarme con el Dpto ${depto}.`;
    const encodedMsg = encodeURIComponent(texto);
    const esMovil = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const baseUrl = esMovil ? "https://api.whatsapp.com/send" : "https://web.whatsapp.com/send";
    const url = `${baseUrl}?phone=${contacto}&text=${encodedMsg}`;
    window.open(url, "_blank");
    mostrarMensaje("Mensaje preparado para enviar.");
  }

  function avisarPorteria() {
    const persona = contactos["PB-Porteria"][0];
    const texto = "Hola, estoy en la entrada del edificio. Necesito comunicarme con la portería.";
    const encodedMsg = encodeURIComponent(texto);
    const esMovil = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const baseUrl = esMovil ? "https://api.whatsapp.com/send" : "https://web.whatsapp.com/send";
    const url = `${baseUrl}?phone=${persona.numero}&text=${encodedMsg}`;
    window.open(url, "_blank");
    mostrarMensaje("Aviso enviado a portería.");
  }

  // Si querés, podés restaurar la última selección al cargar la página:
  window.onload = () => {
    const ultimoDepto = localStorage.getItem("ultimoDepto");
    if (ultimoDepto && contactos[ultimoDepto]) {
      deptoSelect.value = ultimoDepto;
      actualizarPersonas();
    }
  };
</script>
